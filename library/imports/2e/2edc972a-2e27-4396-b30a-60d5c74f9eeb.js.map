{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Scripts\\Home\\Time/assets\\Scripts\\Home\\Time\\TimeController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Scripts\\Home\\Time","sourcesContent":["﻿import global from \"../../Common/Global\";\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TimeController extends cc.Component {\r\n\r\n    private Obj: any = {\r\n        clock: null,\r\n        timer: null,\r\n        countdownSecond: 0,\r\n        stage: 0,\r\n        time: null,\r\n        time2: null\r\n    }\r\n    \r\n\r\n    @property(cc.Node)\r\n    stage: cc.Node = null;\r\n\r\n    Reset() {\r\n        this.Obj.clock.active = false;\r\n        this.activeButton(null); // 下方宣告此函式的細節，要啟動哪一個階段\r\n    }\r\n\r\n    init() {\r\n\r\n        //var self = this;\r\n        this.Obj = {\r\n            clock: cc.find(\"Clock\", this.node),\r\n            time: cc.find(\"Clock/time\", this.node),\r\n            time2: cc.find(\"Clock/time2\", this.node)\r\n           \r\n        };\r\n\r\n    }\r\n\r\n    callback() {\r\n        let self = this;\r\n        if (self.Obj.countdownSecond === 1) {\r\n            // 在第六次执行回调时取消这个计时器\r\n            this.unschedule(this.callback);\r\n        }\r\n        self.Obj.countdownSecond--;\r\n        self.UpdateTimer2(self.Obj.countdownSecond);\r\n    }\r\n\r\n    start() { // 進入點\r\n        let self = this;\r\n\r\n        this.init(); // 找clock位置\r\n\r\n        // THIS MOVE TO STAGECONTROLLER\r\n        /*global.Instance.EventListener.on(\"roomReady\", function (event, Info) {\r\n            self.activeButton(0);\r\n            cc.log(\"activeButton : 0\");\r\n        });*/\r\n\r\n        // THIS MOVE TO STAGECONTROLLER\r\n        /*global.Instance.EventListener.on(\"stageChange\", function (event, stage, timeout) {\r\n            cc.log(\"activeButton : %d\", stage);\r\n            self.activeButton(stage);\r\n            cc.log(\"activeFinish : %d\", stage);\r\n            if (stage == 2 || stage == 3 || stage == 4) {\r\n                cc.log(\"enter clock activte...\");\r\n                self.Obj.countdownSecond = timeout;\r\n                self.Obj.clock.active = true;\r\n                self.UpdateTimer2(timeout);\r\n                self.schedule(self.callback, 1);\r\n            }\r\n            else {\r\n                cc.log(\"enter clock hide...\");\r\n                self.Obj.clock.active = false;\r\n            }\r\n        });*/\r\n\r\n\r\n        this.Reset();// 讓時鐘消失，回到無階段\r\n        //this.activeButton(0); // 階段waiting被啟動\r\n        this.activeButton(-1); // 沒有任何階段被啟動\r\n    }\r\n\r\n    unscheduleTimer(){\r\n        let self = this;\r\n        self.unschedule(self.callback);\r\n        self.Obj.clock.active = false;\r\n    }\r\n\r\n    activeButton(Type) { // 啟動哪一個階段\r\n        cc.log(\"active %d\", Type);\r\n        for (var i = 0; i < this.stage.getChildren().length; i++) {\r\n            this.stage.getChildren()[i].active = (i == Type);\r\n        }\r\n        // 根據的是stage中，每一個階段的位子，例如搶樁是位置1，下注是位置2，等等\r\n\r\n    }\r\n\r\n    //更新倒數計時鬧鐘(當從SERVER傳來時)\r\n    UpdateCounter(timerInfo) {\r\n        let self = this;\r\n        this.Reset();// 先讓時鐘消失，回到階段0\r\n\r\n        this.activeButton(timerInfo.active);// timerInfo是server傳來的資料，包含在哪一個階段\r\n\r\n        if (timerInfo.whosTurn == \"Result\") { // 如果到了顯示結果階段，但是牛牛不用(我們還沒改server，所以先不刪)\r\n            // 在stage中，Result/timer的組件Num2Sprite\r\n            cc.find(\"Result/timer\", this.stage).getComponent(\"Num2Sprite\").setNum(timerInfo.countdownSecond);\r\n        }\r\n        else\r\n            if (timerInfo.whosTurn != null) {\r\n                this.Obj.clock.active = true; // 啟動時鐘\r\n                this.Obj.clock.getComponent(\"Clock\").settime(timerInfo.countdownSecond, self); // 寫上剩餘時間\r\n                if (timerInfo.countdownSecond < 10) // 如果剩餘時間小於10，撥放動畫\r\n                    this.Obj.clock.getComponent(cc.Animation).play();\r\n            }\r\n\r\n       \r\n    }\r\n\r\n    UpdateTimer(timerInfo){\r\n        let self = this;\r\n        this.Obj.clock.getComponent(\"Clock\").settime(timerInfo.countdownSecond, self); // 寫上剩餘時間\r\n    }\r\n\r\n    UpdateTimer2(time){\r\n        let self = this;\r\n        if (time == 9) time = 8;\r\n        else if (time == 8) time = 9;\r\n        this.Obj.clock.getComponent(\"Clock\").settime(time, self); // 寫上剩餘時間\r\n    }\r\n\r\n    // FUNCTION FOR STAGE CONTROLLER WHEN STAGE CHANGE\r\n    hideClock() {\r\n        let self = this;\r\n        self.Obj.clock.active = false;\r\n    }\r\n\r\n    setCountDownSecond(timeout : number) {\r\n        let self = this;\r\n        self.Obj.countdownSecond = timeout;\r\n        self.Obj.clock.active = true;\r\n        self.UpdateTimer2(timeout);\r\n        self.schedule(self.callback, 1);\r\n    }\r\n\r\n}\r\n"]}