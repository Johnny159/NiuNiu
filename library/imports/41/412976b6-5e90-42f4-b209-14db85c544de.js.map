{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Scripts\\Network/assets\\Scripts\\Network\\NetworkManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Network","sourcesContent":["import global from \"../Common/Global\";\r\nimport * as NN from \"../NNDefine\";\r\nimport PlayerInfoViewController from \"../Home/Player/PlayerInfoViewController\"\r\n\r\nexport default class NetworkManager {\r\n    \r\n    private _socket;\r\n    //private serverURL:string = \"http://140.118.175.76:5070/\";\r\n    private serverURL:string = \"http://60.251.26.6:8073/\";\r\n    \r\n    private self = this;\r\n\r\n    ConnectServer() {\r\n        cc.log(\"con server\");\r\n        this._socket = io.connect(this.serverURL, {\r\n            reconnection: false\r\n        });\r\n        cc.log(\"connect success\");\r\n        this.eventRegister();\r\n    };\r\n\r\n    socket(){ return this._socket; }\r\n\r\n    LogIn(token:string){\r\n        let self = this;\r\n        let no:number = 6006;\r\n        let json= {\r\n            \"no\" : no,\r\n            \"data\" : token\r\n        };\r\n        //console.log(\"token Reg : \"+ token);\r\n        this._socket.emit(\"action\",json ,function(data){\r\n            console.log(\"token callback : \"+JSON.stringify(data));\r\n            //req table after token register finish\r\n            let tableJson= {\r\n                \"no\" : 6001,\r\n                \"data\" : {\"oid\": 13}\r\n            };//2 player\r\n            console.log(\"table req:\"+tableJson); \r\n            self._socket.emit(\"action\",tableJson ,function(errCode,message){\r\n                console.log(\"table req callback: \"+JSON.stringify(errCode) +\",\" + message);\r\n            })\r\n        })\r\n\r\n       \r\n    }\r\n\r\n    /**\r\n     * 搶莊\r\n     * @param rate 倍率\r\n     */\r\n    rob_bet(rate: number){\r\n        let no:number = 6072;\r\n        let json= {\r\n            \"no\" : no,\r\n            \"data\" : {\r\n                \"rob_bet\" : 1//use 1 to test int problem\r\n            }\r\n        };\r\n        this._socket.emit(\"action\",json ,function(code,data){\r\n            cc.log(\"code : \" + code);\r\n            if(code != 200) cc.warn(\"rob_bet error : \" + data.error);\r\n            else cc.log(\"rob_bet success\");\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 一般倍率下注\r\n     * @param rate 倍率\r\n     */\r\n    place_bet(rate: number){\r\n        let no:number = 6073;\r\n        let json= {\r\n            \"no\" : no,\r\n            \"data\" : {\r\n                \"place_bet\" : rate\r\n            }\r\n        };\r\n        this._socket.emit(\"action\",json ,function(code,data){\r\n            cc.log(\"code : \" + code);\r\n            if(code != 200) cc.warn(\"place_bet error : \" + data.error);\r\n            else cc.log(\"place_bet success\");\r\n        })\r\n    }\r\n\r\n    eventRegister(){\r\n        let self = this;\r\n        //socket event listener\r\n        this._socket.on(\"SwitchScene\", function (SceneIndex) {\r\n            //cc.log(\"get switch scene req\");\r\n            global.Instance.EventListener.notify(\"SwitchScene\", SceneIndex);\r\n        });\r\n\r\n        this._socket.on(\"roomReady\", function (Info) {\r\n            //cc.log(\"network get : \", Info);\r\n            global.Instance.EventListener.notify(\"roomReady\", Info);\r\n        });\r\n\r\n        this._socket.on(\"stageChange\", function (stage, timeout) {\r\n            global.Instance.EventListener.notify(\"stageChange\", stage, timeout);\r\n        });\r\n\r\n        this._socket.on(\"stageChange\", function (stage, timeout) {\r\n            global.Instance.EventListener.notify(\"stageChange\", stage, timeout);\r\n        });\r\n\r\n        this._socket.on(\"action\", function (data) {\r\n            console.log(\"action : \" + JSON.stringify(data));\r\n        });\r\n\r\n        this._socket.on(\"response\", function (data) {\r\n            console.log(\"response : \" + JSON.stringify(data));\r\n            if(data == 6001)  //get table success\r\n                global.Instance.EventListener.notify(\"SwitchScene\", 1); \r\n             cc.log(\"data.no: \"+data.no); \r\n            switch(data.no){   \r\n                \r\n                ///////stage info////////////\r\n                case 6101://rob bet stage info\r\n                    self.receiveStageInfo(data);\r\n                    break;\r\n                case 6103://place bet stage info\r\n                    self.placeBetStageInfo(data);\r\n                    break;\r\n                case 6105:\r\n                    self.receiveCard(data);\r\n                    break;\r\n                //////bet///////////////    \r\n                case 6102:\r\n                    self.receiveRobBet(data);\r\n                    break;\r\n                case 6104:\r\n                    self.receivePlaceBet(data);\r\n                    break;\r\n                //////clock / stage change///////    \r\n                case 6107:\r\n                    cc.warn(\"change stage\" + data.stage + \"time:\"+data.time);\r\n                    global.Instance.EventListener.notify(\"stageChange\", data.stage, data.time);\r\n                    break;\r\n                default:\r\n                break;\r\n            }\r\n        });\r\n\r\n        this._socket.on(\"kingsRate\", function (Info) {\r\n            //cc.log(\"Network get kingsRate\");\r\n            global.Instance.EventListener.notify(\"kingsRate\", Info);\r\n        });\r\n\r\n        this._socket.on(\"playersRate\", function (Info) {\r\n            //cc.log(\"Network get playersRate\");\r\n            global.Instance.EventListener.notify(\"playersRate\", Info);\r\n        });\r\n        this._socket.on(\"myCard\", function (Info) {\r\n            global.Instance.EventListener.notify(\"myCard\", Info);\r\n\r\n        });\r\n        this._socket.on(\"eachPlayerCard\", function (Info) {\r\n            global.Instance.EventListener.notify(\"eachPlayerCard\", Info);\r\n\r\n        });\r\n        this._socket.on(\"pokerAnimation\", function (Info) {\r\n            global.Instance.EventListener.notify(\"pokerAnimation\", Info);\r\n        });\r\n\r\n        this._socket.on(\"Animation\", function (animationName) {\r\n            global.Instance.EventListener.notify(\"Animation\", animationName);\r\n        });\r\n\r\n        this._socket.on(\"moneyFlow\", function (Info) {\r\n            global.Instance.EventListener.notify(\"moneyFlow\", Info);\r\n        });\r\n        \r\n\r\n    }\r\n    \r\n    /**\r\n     * 6101\r\n     * @param data \r\n     */\r\n    receiveStageInfo(data){\r\n        //stage info\r\n        //room\r\n        //data.room\r\n\r\n        //get players data\r\n        let playerCount = 2;\r\n        let gameInfo: NN.GameInfo = NN.GameInfo.Inst;\r\n        gameInfo.playerCount = playerCount;\r\n        for (let index = 0; index < playerCount; index++) {\r\n            gameInfo.players.push(new NN.Player());\r\n        }\r\n        gameInfo.players[0].uid = data.main_player.uid;\r\n        gameInfo.players[0].money = data.main_player.coins;\r\n        gameInfo.players[0].name = data.main_player.nickname;\r\n        gameInfo.players[0].iconID = data.main_player.avatar;\r\n        \r\n        let playerIndex = 0;\r\n        for (let _key in data.players) {\r\n            playerIndex++;\r\n            gameInfo.players[playerIndex].uid = data.players[_key].uid;\r\n            gameInfo.players[playerIndex].money = data.players[_key].coins;\r\n            gameInfo.players[playerIndex].name = data.players[_key].nickname;\r\n            gameInfo.players[playerIndex].iconID = data.players[_key].avatar;\r\n            gameInfo.players[playerIndex].vip = data.players[_key].vip;\r\n        }\r\n\r\n        PlayerInfoViewController.Inst.init();\r\n        PlayerInfoViewController.Inst.updatePlayer();                        \r\n    }\r\n\r\n    /**\r\n     * 6103\r\n     * @param data \r\n     */\r\n    placeBetStageInfo(data){\r\n\r\n    }\r\n\r\n    /**\r\n     * 6102\r\n     * @param data \r\n     */\r\n    receiveRobBet(data){\r\n\r\n    }\r\n\r\n    /**\r\n     * 6103\r\n     * @param data \r\n     */\r\n    receivePlaceBet(data){\r\n\r\n    }\r\n\r\n    /**\r\n     * 6107\r\n     * @param data\r\n     */\r\n    receiveCard(data){\r\n\r\n    }\r\n\r\n}\r\n"]}