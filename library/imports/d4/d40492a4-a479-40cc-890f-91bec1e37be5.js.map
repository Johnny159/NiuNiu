{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Scripts\\Common/assets\\Scripts\\Common\\ResourcesMgr.ts"],"names":[],"mappings":";;;;;AACM,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAE5C;;GAEG;AAEH;IAA0C,gCAAY;IAMlD;QAAA,YACI,iBAAO,SAKV;QAXD,iBAAiB;QACT,iBAAW,GAAG,EAAE,CAAC;QACzB,kBAAkB;QACV,eAAS,GAAG,EAAE,CAAC;QAKnB,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAElC,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAI,CAAC,IAAI,CAAC,CAAC;;IAC1C,CAAC;IAED;;;;OAIG;IACH,8BAAO,GAAP,UAAQ,SAA+B;QAAvC,iBA4BC;QA5BO,0BAAA,EAAA,qBAA+B;QACnC,EAAE,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;QAE/B,IAAI,iBAAiB,GAAG,CAAC,CAAC;QAC1B,IAAI,SAAS,GAAS,IAAI,CAAC,SAAS,CAAC;QACrC,IAAI,SAAS,IAAI,SAAS,EAAE;YACxB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACvC,EAAE,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,WAAW,EAC7C,UAAC,cAAc,EAAE,UAAU,EAAE,IAAI,IAAO,CAAC,EACzC,UAAC,GAAG,EAAE,MAAM;oBACR,KAAK,IAAI,GAAC,GAAG,CAAC,EAAE,GAAC,GAAG,MAAM,CAAC,MAAM,EAAE,GAAC,EAAE,EAAE;wBACpC,uCAAuC;wBACvC,IAAI,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC,GAAC,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;4BAC1C,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC,GAAC,CAAC,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,GAAC,CAAC,CAAC;4BAC7C,EAAE,CAAC,GAAG,CAAC,gBAAgB,GAAG,MAAM,CAAC,GAAC,CAAC,CAAC,IAAI,GAAG,UAAU,CAAC,CAAC;yBAC1D;qBACJ;oBAED,iBAAiB,EAAE,CAAC;oBACpB,IAAI,SAAS,IAAI,SAAS;wBACtB,SAAS,CAAC,iBAAiB,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC;gBACxD,CAAC,CAAC,CAAC;aACV;SACJ;aACI;YACD,SAAS,CAAC,CAAC,CAAC,CAAC;SAChB;IAEL,CAAC;IAED;;;OAGG;IACH,2BAAI,GAAJ,UAAK,IAAY;QACb,IAAI,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE;YAC1B,EAAE,CAAC,GAAG,CAAC,mBAAmB,GAAG,IAAI,GAAG,UAAU,CAAC,CAAC;YAChD,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;SACjC;QACD,OAAO,IAAI,CAAC;IAChB,CAAC;IA3DgB,YAAY;QADhC,OAAO;OACa,YAAY,CA6DhC;IAAD,mBAAC;CA7DD,AA6DC,CA7DyC,EAAE,CAAC,SAAS,GA6DrD;kBA7DoB,YAAY","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Common","sourcesContent":["\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**\r\n * 動態資源管理物件\r\n */\r\n@ccclass\r\nexport default class ResourcesMgr extends cc.Component {\r\n    /**當前已讀取的檔案存放區 */\r\n    private spriteFrame = {};\r\n    /**各場景須預讀取的檔案列表 */\r\n    private assetList = [];\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.assetList.push(\"player/img\");\r\n\r\n        cc.game.addPersistRootNode(this.node);\r\n    }\r\n\r\n    /**\r\n     * 讀取指定場景所需的動態資源\r\n     * @param idx 指定場景ID\r\n     * @param onloading loading中途觸發事件\r\n     */\r\n    preload(onloading: Function = undefined) {\r\n        cc.log(\"ResourcesMgr.preload\");\r\n\r\n        let assetListComplete = 0;\r\n        let assetList:any[] = this.assetList;\r\n        if (assetList != undefined) {\r\n            for (let i = 0; i < assetList.length; i++) {\r\n                cc.loader.loadResDir(assetList[i], cc.SpriteFrame,\r\n                    (completedCount, totalCount, item) => { },\r\n                    (err, assets) => {\r\n                        for (let i = 0; i < assets.length; i++) {\r\n                            //cc.log(\"check \" + assets[i].name);   \r\n                            if (this.spriteFrame[assets[i].name] == null) {\r\n                                this.spriteFrame[assets[i].name] = assets[i];\r\n                                cc.log(\"[[Resources]] \" + assets[i].name + \" loaded.\");\r\n                            }\r\n                        }\r\n\r\n                        assetListComplete++;\r\n                        if (onloading != undefined)\r\n                            onloading(assetListComplete / assetList.length);\r\n                    });\r\n            }\r\n        }\r\n        else {\r\n            onloading(1);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * 取得已讀取進遊戲的動態資源\r\n     * @param name 動態資源名稱\r\n     */\r\n    load(name: string) {\r\n        if (name in this.spriteFrame) {\r\n            cc.log(\"[Resources] Load \" + name + \" success\");\r\n            return this.spriteFrame[name];\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n"]}